!function(e){var t={};function i(s){if(t[s])return t[s].exports;var a=t[s]={i:s,l:!1,exports:{}};return e[s].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(s,a,function(t){return e[t]}.bind(null,a));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){"use strict";i.r(t),i.d(t,"init",(function(){return X})),i.d(t,"GridMap",(function(){return E}));var s={FullScreen:!0,Drag:!0,Scale:!0,boxColor:"#FFFF99",collision:!0,needGrid:!1,GridSize:200};var a={options:s,setOptions:function(e){for(let t in e)s[t]=e[t]}};const n=Symbol("mapinfo");class l{constructor(e){this[n]=[],null!=e&&addMapInfo(e)}addMapInfo(e){for(let t=0;t<e.length;t++){let i={};for(let s in e[t])if("position"!=s.toLowerCase())if("size"!=s.toLowerCase())i[s]=e[t][s];else{let a=e[t][s].split(",");if(2!=a.length){console.warn("[Warning]Map size has invalid,must be only 2 dimension");continue}i.sizeX=a[0],i.sizeY=a[1]}else{let a=e[t][s].split(",");if(2!=a.length){console.warn("[Warning]Map position has invalid,must be only 2 dimension");continue}i.x=a[0],i.y=a[1]}i.x&&i.y&&i.sizeX&&i.sizeY?this[n].push(i):console.warn("[Warning]Each map info must has position and size.")}}removeMapInfo(e){for(let t=this[n].length-1;t>=0;t++)this[n][t].id==e&&this[n].splice(t,1)}removeAll(){this[n]=[]}getMapInfo(){return this[n]}}var o=a.options;class r{constructor(e){null!=e&&e.constructor==HTMLDivElement?(this.div=e,this.GridMap_Canvas=document.createElement("canvas"),e.appendChild(this.GridMap_Canvas),this.GridMap_Canvas.width=e.offsetWidth,this.GridMap_Canvas.height=e.offsetHeight,this.GridMap_Canvas.id="GridMap_Canvas",this.GridMap_Canvas_Full_Div=null,this.GridMap_Canvas_Full=null,o.FullScreen&&this.addFullScreen(),this.showCanvas=this.GridMap_Canvas):console.error("[error]The passed object is not a div element")}addFullScreen(){this.GridMap_Canvas_Full_Div=document.createElement("div"),this.GridMap_Canvas_Full_Div.width=document.body.offsetWidth,this.GridMap_Canvas_Full_Div.height=document.body.offsetHeight,this.GridMap_Canvas_Full_Div.id="GridMap_Canvas_Full_Div",this.GridMap_Canvas_Full_Div.style.position="absolute",this.GridMap_Canvas_Full_Div.style["z-index"]=999,this.GridMap_Canvas_Full_Div.style.backgroundColor="white",this.GridMap_Canvas_Full_Div.style.display="none",this.GridMap_Canvas_Full_Div.style.left=0,this.GridMap_Canvas_Full_Div.style.top=0,document.body.appendChild(this.GridMap_Canvas_Full_Div),this.GridMap_Canvas_Full=document.createElement("canvas"),this.GridMap_Canvas_Full.width=this.GridMap_Canvas_Full_Div.width,this.GridMap_Canvas_Full.height=this.GridMap_Canvas_Full_Div.height,this.GridMap_Canvas_Full.id="GridMap_Canvas_Full",this.GridMap_Canvas_Full_Div.appendChild(this.GridMap_Canvas_Full)}removeFullScreen(){this.GridMap_Canvas_Full.remove(),this.GridMap_Canvas_Full_Div.remove()}}const h=Symbol("x"),d=Symbol("y"),c=Symbol("scale"),u=Symbol("drag"),p=Symbol("focus"),f=Symbol("minscale"),v=Symbol("maxscale"),g=Symbol("scaleRate");class m{constructor(){this[h]=0,this[d]=0,this[c]=2,this[u]=!0,this[p]=null,this[f]=.5,this[v]=5,this[g]=.2}setPos(e,t){null!=e&&null!=t?(this[h]=parseFloat(e),this[d]=parseFloat(t)):console.error("[error]to set Position must has x and y.")}getPos(){return[this[h],this[d]]}setPosX(e){this[h]=parseFloat(e)}setPosY(e){this[d]=parseFloat(e)}addPosX(e){this[h]=this[h]+parseFloat(e)}addPosY(e){this[d]=this[d]+parseFloat(e)}setScale(e){this[c]=e}getScale(){return this[c]}addScale(e){this[c]=null==e?this[c]+this[g]>this[v]?this[v]:this[c]+this[g]:this[c]+parseFloat(e)>this[v]?this[v]:this[c]+parseFloat(e)}minusScale(e){this[c]=null==e?this[c]-this[g]<this[f]?this[f]:this[c]-this[g]:this[c]-parseFloat(e)<this[f]?this[f]:this[c]-parseFloat(e)}setFocus(e){this[p]=e}getFocus(){return this[p]}setMinScale(e){this[f]=parseFloat(e)}getMinScale(){return this[f]}addMinScale(e){this[f]=this[f]+parseFloat(e)}setMaxScale(e){this[v]=parseFloat(e)}getMaxScale(){return this[v]}addMaxScale(e){this[v]=this[v]+parseFloat(e)}setScaleRate(e){this[g]=parseFloat(e)}getScaleRate(){return this[g]}addScaleRate(e){this[g]=this[g]+parseFloat(e)}}var _=a.options,C=!0;function M(e,t,i,s,a){let n=document.createElement("canvas"),l=n.getContext("2d");n.width=e.width,n.height=e.height;let o=t-Math.floor(e.width/2)*s,r=o+e.width*s,h=i-Math.floor(e.height/2)*s,d=h+e.height*s,c=[];for(let n=0;n<a.length;n++){let l={},u=parseInt(a[n].x),p=parseInt(u)+parseInt(a[n].sizeX),f=parseInt(a[n].y),v=parseInt(a[n].y)+parseInt(a[n].sizeY);if(null==a[n].image){if(o<u&&r>u&&h<f&&d>f)l.x=(u-t)/s+e.width/2,l.y=(f-i)/s+e.height/2,l.sizeX=r>p?parseInt(a[n].sizeX)/s:(r-u)/s,l.sizeY=d>v?parseInt(a[n].sizeY)/s:(d-f)/s;else if(o<u&&r>u&&h<v&&d>v)l.x=(u-t)/s+e.width/2,l.y=0,l.sizeY=(v-h)/s,l.sizeX=r>p?parseInt(a[n].sizeX)/s:(r-u)/s;else if(o<p&&r>p&&h<f&&d>f)l.x=0,l.y=(f-i)/s+e.height/2,l.sizeX=(p-o)/s,l.sizeY=d>v?parseInt(a[n].sizeY)/s:(d-f)/s;else{if(!(o<p&&r>p&&h<v&&d>v))continue;l.x=0,l.y=0,l.sizeX=(p-o)/s,l.sizeY=(v-h)/s}for(let e in a[n])"x"!=e&&"y"!=e&&"sizeX"!=e&&"sizeY"!=e&&(l[e]=a[n][e]);c.push(l)}else{l.x=(u-t)/s+e.width/2,l.y=(f-i)/s+e.height/2,l.sizeX=parseInt(a[n].sizeX)/s,l.sizeY=parseInt(a[n].sizeY)/s;for(let e in a[n])"x"!=e&&"y"!=e&&"sizeX"!=e&&"sizeY"!=e&&(l[e]=a[n][e]);c.push(l)}}if(_.needGrid){let a=_.GridSize,n=e.width/2-t/s,o=e.height/2-i/s;for(;n>0;)n-=a/s;for(;o>0;)o-=a/s;for(l.setLineDash([5,10]);o<e.height;o+=a/s)l.beginPath(),l.moveTo(0,o),l.lineTo(e.width,o),l.stroke();for(;n<e.width;n+=a/s)l.beginPath(),l.moveTo(n,0),l.lineTo(n,e.height),l.stroke()}let u=[];c.forEach(e=>{if(null!=e.image)u.push(e),0==e.collision&&(e.image.filter="alpha(opacity=40);"),1==C?e.image.onload=function(){l.drawImage(e.image,e.x,e.y,e.sizeX,e.sizeY)}:l.drawImage(e.image,e.x,e.y,e.sizeX,e.sizeY);else{if(null!=e.color)if(l.fillStyle=e.color,0==e.collision){let t=ColorToRGBA(e.color);l.fillStyle="rgba("+t.join(",")+",0.4)"}else l.fillStyle=e.color;else if(0==e.collision){let e=ColorToRGBA(_.boxColor);l.fillStyle="rgba("+e.join(",")+",0.4)"}else l.fillStyle=_.boxColor;l.fillRect(e.x,e.y,e.sizeX,e.sizeY)}});let p=e.getContext("2d");if(p.clearRect(0,0,e.width,e.height),1==C){C=!1;var f=setInterval(()=>{let e=!0;for(let t=0;t<u.length;t++)if(0==u[t].complete){e=!1;break}1==e&&(p.drawImage(n,0,0),clearInterval(f))},200)}else p.drawImage(n,0,0);return!0}function w(e,t,i){var s=i.getBoundingClientRect();return{x:e-s.left-(s.width-i.width)/2,y:t-s.top-(s.height-i.height)/2}}var F=null,G=null;var y={RegisterGragEvent:function(e,t,i,s){let a=!1,n=0,l=0;document.onmousedown=function(t){let i=w(t.clientX,t.clientY,e.showCanvas);i.x>0&&i.x<e.showCanvas.width&&i.y>0&&i.y<e.showCanvas.height&&(a=!0,n=i.x,l=i.y)},document.onmousemove=function(o){if(a){let a=w(o.clientX,o.clientY,e.showCanvas);t.addPosX(-(a.x-n)),t.addPosY(-(a.y-l));let r=t.getPos();M(e.showCanvas,r[0],r[1],t.getScale(),i.getMapInfo().concat(s.getItemsInfo())),n=a.x,l=a.y}},document.onmouseup=function(e){a=!1,n=0,l=0}},UnRegisterGragEvent:function(){document.onmousedown=null,document.onmousemove=null,document.onmouseup=null},RegisterScaleEvent:function(e,t,i,s){e.onmousewheel=e.onwheel=function(a){a.wheelDelta>0?t.minusScale():t.addScale();let n=t.getPos();M(e,n[0],n[1],t.getScale(),i.getMapInfo().concat(s.getItemsInfo()))}},UnRegisterScaleEvent:function(e){e.onmousewheel=e.onwheel=null},RegisterFullScreenShow:function(e,t,i,s){F=()=>{!function(e,t,i,s){let a=e.GridMap_Canvas.getContext("2d"),n=e.GridMap_Canvas_Full.getContext("2d");a.clearRect(0,0,e.GridMap_Canvas.width,e.GridMap_Canvas.height),n.clearRect(0,0,e.GridMap_Canvas_Full.width,e.GridMap_Canvas_Full.height),e.showCanvas=e.GridMap_Canvas;let l=t.getPos();M(e.GridMap_Canvas,l[0],l[1],t.getScale(),i.getMapInfo().concat(s.getItemsInfo())),e.GridMap_Canvas_Full_Div.style.display="none"}(e,t,i,s)},e.GridMap_Canvas_Full.addEventListener("dblclick",F,!1),G=()=>{!function(e,t,i,s){let a=e.GridMap_Canvas.getContext("2d"),n=e.GridMap_Canvas_Full.getContext("2d");a.clearRect(0,0,e.GridMap_Canvas.width,e.GridMap_Canvas.height),n.clearRect(0,0,e.GridMap_Canvas_Full.width,e.GridMap_Canvas_Full.height),e.showCanvas=e.GridMap_Canvas_Full;let l=t.getPos();M(e.GridMap_Canvas_Full,l[0],l[1],t.getScale(),i.getMapInfo().concat(s.getItemsInfo())),GridMap_Canvas_Full_Div.style.display=""}(e,t,i,s)},e.GridMap_Canvas.addEventListener("dblclick",G,!1)},UnRegisterFullScreenShow:function(e){e.GridMap_Canvas.removeEventListener("dbclick",G),e.GridMap_Canvas_Full.removeEventListener("dblclick",F)}};var S=a.options;class I{constructor(e,t,i,s){this.gridClass=e,this.camera=t,this.map=i,this.item=s,S.FullScreen&&y.RegisterFullScreenShow(this.gridClass,this.camera,this.map,this.item),S.Drag&&y.RegisterGragEvent(this.gridClass,this.camera,this.map,this.item),S.Scale&&(y.RegisterScaleEvent(this.gridClass.GridMap_Canvas,this.camera,this.map,this.item),y.RegisterScaleEvent(this.gridClass.GridMap_Canvas_Full,this.camera,this.map,this.item)),function(e,t,i,s){window.onresize=function(){e.GridMap_Canvas.width=e.div.offsetWidth,e.GridMap_Canvas.height=e.div.offsetHeight,e.GridMap_Canvas_Full.width=window.document.body.offsetWidth,e.GridMap_Canvas_Full.height=window.document.body.offsetHeight;let a=t.getPos();M(e.showCanvas,a[0],a[1],t.getScale(),i.getMapInfo().concat(s.getItemsInfo()))}}(e,t,i,s)}UnRegisterFullScreen(){S.FullScreen=!1,y.UnRegisterFullScreenShow(this.gridClass)}UnRegisterDrag(){S.Drag=!1,y.UnRegisterGragEvent()}UnRegisterScale(){S.Scale=!1,y.UnRegisterScaleEvent(this.gridClass.GridMap_Canvas),y.UnRegisterScaleEvent(this.gridClass.GridMap_Canvas_Full)}}const b=Symbol("itemInfo");class z{constructor(e){this[b]=[],null!=e&&addItemInfo(e)}addItemInfo(e){e.forEach(e=>{let t=!0;if(e.hasOwnProperty("id")){for(let i=0;i<this[b].length;i++)if(this[b][i].id==e.id){console.error("[error]Item id must be unique."),t=!1;break}}else console.error("[warning]You need a item id."),e.id=function(){let e=(new Date).getTime();return((1+Math.random())*e|0).toString(16)}();if(!t)return;let i={};for(let t in e)if("position"!=t.toLowerCase())if("size"!=t.toLowerCase())i[t]=e[t];else{let s=e[t].split(",");if(2!=s.length){console.warn("[Warning]Map size has invalid,must be only 2 dimension");continue}i.sizeX=s[0],i.sizeY=s[1]}else{let s=e[t].split(",");if(2!=s.length){console.warn("[Warning]Map position has invalid,must be only 2 dimension");continue}i.x=s[0],i.y=s[1]}i.x&&i.y&&i.sizeX&&i.sizeY?(e.hasOwnProperty("collision")||(e.collision=!0),this[b].push(i)):console.error("[Error]Each item info must has position and size.")})}removeItem(e){for(let t=this[b].length-1;t>=0;t++)if(this[b][t].id==e){this[b].splice(t,1);break}}getItemsInfo(){return this[b]}getItem(e){for(let t=this[b].length-1;t>=0;t++)if(this[b][t].id==e)return this[b][t]}}var x=a.options;function R(e,t,i,s,a){let n=0,l=!1,o=null,r=s.Item.getItemsInfo();for(n=0;n<r.length;n++)if(r[n].id==e){o=r[n];break}null!=o?(a&&(t=o.x-t,i=o.y-i),x.collision&&(l=function(e,t,i,s){let a=!0;for(let n=0;n<t.length;n++)if(t[n].id!=e.id&&t[n].collision&&0!=t[n].collision){let l=t[n],o=Math.abs((2*parseFloat(i)+parseFloat(e.sizeX))/2-(2*parseFloat(l.x)+parseFloat(l.sizeX))/2),r=Math.abs((2*parseFloat(s)+parseFloat(e.sizeY))/2-(2*parseFloat(l.y)+parseFloat(l.sizeY))/2);if(o<=(parseFloat(e.sizeX)+parseFloat(l.sizeX))/2&&r<=(parseFloat(e.sizeY)+parseFloat(l.sizeY))/2){a=!1;break}}return a}(o,s.Map.getMapInfo().concat(s.Item.getItemsInfo()),t,i)),l&&(r[n].x=t,r[n].y=i,s.Camera.getFocus()==e&&s.Camera.setPos(t,i),s.refresh())):console.error("[error]could not found item which id="+e)}class Y{constructor(e){this.controller=e,this.moveItem=function(e,t,i,s){R(e,t,i,this.controller,s)}}}class D{constructor(e,t){a.setOptions(t),this.gridClass=new r(e),this.Map=new l,this.Item=new z,this.Camera=new m,this.Ext=new Y(this),this.ListenerController=new I(this.gridClass,this.Camera,this.Map,this.Item)}addMap(e){this.Map.addMapInfo(e)}removeMap(e){null==e?this.Map.removeAll():this.Map.removeMapInfo(e)}addItems(e){this.Item.addItemInfo(e)}removeItem(e){this.Item.removeItem(e)}refresh(){let e=this.Camera.getPos();M(this.gridClass.showCanvas,e[0],e[1],this.Camera.getScale(),this.Map.getMapInfo().concat(this.Item.getItemsInfo()))}showGrid(e){null!=e?a.setOptions({needGrid:!0,GirdSize:e}):a.setOptions({needGrid:!0})}hiddenGrid(){a.setOptions({needGrid:!1})}}function X(e,t){return new D(e,t)}var E=new Object;E.init=X,window.GridMap=E,"undefined"!=typeof window&&window.Vue&&window.Vue.component("segredo-gridmap",E)}]);